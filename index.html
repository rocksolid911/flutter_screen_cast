<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Test Cast Receiver</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: #000;
            color: #0f0;
            font-family: monospace;
            font-size: 24px;
        }
        .status { color: #ff0; }
        .error { color: #f00; }
        .success { color: #0f0; }
    </style>
</head>
<body>
    <h1>üé¨ Cast Receiver Test - App ID: 7D1A32C2</h1>
    <p id="status" class="status">Initializing Cast Receiver...</p>
    <div id="logs"></div>

    <script src="//www.gstatic.com/cast/sdk/libs/caf_receiver/v3/cast_receiver_framework.js"></script>
    <script>
        const statusEl = document.getElementById('status');
        const logsEl = document.getElementById('logs');
        
        function log(message, type = 'success') {
            console.log(message);
            const logEntry = document.createElement('div');
            logEntry.className = type;
            logEntry.textContent = new Date().toLocaleTimeString() + ': ' + message;
            logsEl.appendChild(logEntry);
            
            // Keep only last 10 log entries
            while (logsEl.children.length > 10) {
                logsEl.removeChild(logsEl.firstChild);
            }
        }
        
        try {
            log('üöÄ Starting Cast Receiver for App ID: 7D1A32C2');
            statusEl.textContent = 'üîÑ Starting Cast Receiver...';
            
            // Initialize Cast Receiver
            const castReceiverContext = cast.framework.CastReceiverContext.getInstance();
            
            // Handle sender connections
            castReceiverContext.addEventListener(
                cast.framework.system.EventType.SENDER_CONNECTED,
                (event) => {
                    log('üì± Sender connected: ' + event.senderId, 'success');
                    statusEl.textContent = '‚úÖ Connected to sender!';
                }
            );
            
            castReceiverContext.addEventListener(
                cast.framework.system.EventType.SENDER_DISCONNECTED,
                (event) => {
                    log('üì± Sender disconnected: ' + event.senderId, 'status');
                    statusEl.textContent = '‚ùå Sender disconnected';
                }
            );
            
            castReceiverContext.addEventListener(
                cast.framework.system.EventType.READY,
                () => {
                    log('‚úÖ Cast Receiver ready for App ID: 7D1A32C2', 'success');
                    statusEl.textContent = 'üéØ Ready for connections (App ID: 7D1A32C2)';
                }
            );
            
            // Listen for custom messages
            castReceiverContext.addCustomMessageListener(
                'urn:x-cast:com.isvisoft.flutter_screen_recording',
                (customEvent) => {
                    log('üì® Received message: ' + customEvent.data, 'success');
                    
                    try {
                        const message = JSON.parse(customEvent.data);
                        if (message.type === 'screen_frame') {
                            log('üñºÔ∏è Screen frame received', 'success');
                        }
                    } catch (e) {
                        log('‚ùå Error parsing message: ' + e.message, 'error');
                    }
                }
            );
            
            // Start the receiver
            const castReceiverOptions = new cast.framework.CastReceiverOptions();
            castReceiverOptions.disableIdleTimeout = true;
            
            log('üé¨ Starting Cast Receiver with options...', 'status');
            castReceiverContext.start(castReceiverOptions);
            
        } catch (error) {
            log('‚ùå Error initializing Cast Receiver: ' + error.message, 'error');
            statusEl.textContent = '‚ùå Failed to initialize';
        }
    </script>
</body>
</html>
